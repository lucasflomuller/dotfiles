---
# Chezmoi dotfiles management

- name: "🔍 Check if chezmoi source directory exists"
  stat:
    path: "{{ ansible_user_dir }}/.local/share/chezmoi"
  register: chezmoi_source_check

- name: "📥 Initialize chezmoi with dotfiles repository"
  shell: "chezmoi init {{ chezmoi_repo }}"
  when: not chezmoi_source_check.stat.exists

- name: "🔄 Update chezmoi source (git pull)"
  shell: "chezmoi update --no-apply"
  when: chezmoi_source_check.stat.exists

- name: "🏠 Apply dotfiles with chezmoi"
  shell: "chezmoi apply"

- name: "🔧 Verify chezmoi status"
  shell: "chezmoi status"
  register: chezmoi_status
  changed_when: false

- name: "📋 Display chezmoi status"
  debug:
    msg: "{{ chezmoi_status.stdout_lines }}"
  when: chezmoi_status.stdout_lines | length > 0