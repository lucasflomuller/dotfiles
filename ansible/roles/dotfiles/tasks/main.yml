---
# Chezmoi dotfiles management

- name: "ðŸ” Check if chezmoi source directory exists"
  stat:
    path: "{{ ansible_user_dir }}/.local/share/chezmoi"
  register: chezmoi_source_check

- name: "ðŸ“¥ Initialize chezmoi with dotfiles repository"
  shell: "chezmoi init {{ chezmoi_repo }}"
  when: not chezmoi_source_check.stat.exists

- name: "ðŸ”„ Update chezmoi source (git pull)"
  shell: "chezmoi update --no-apply"
  when: chezmoi_source_check.stat.exists

- name: "ðŸ  Apply dotfiles with chezmoi"
  shell: "chezmoi apply"

- name: "ðŸ”§ Verify chezmoi status"
  shell: "chezmoi status"
  register: chezmoi_status
  changed_when: false

- name: "ðŸ“‹ Display chezmoi status"
  debug:
    msg: "{{ chezmoi_status.stdout_lines }}"
  when: chezmoi_status.stdout_lines | length > 0